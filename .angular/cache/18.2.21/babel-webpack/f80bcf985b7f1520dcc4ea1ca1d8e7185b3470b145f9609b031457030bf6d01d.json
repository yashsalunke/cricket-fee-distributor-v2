{"ast":null,"code":"export class ContributionCalculatorService {\n  calculate(players, amount) {\n    if (players.length === 0) return players;\n    const sum = players.reduce((s, p) => s + (p.opportunityScore || 0), 0);\n    players.forEach(p => {\n      let pct = (p.opportunityScore || 0) / sum * 100;\n      pct -= this.reward(p);\n      pct = Math.max(3, Math.min(15, pct));\n      p.finalPercent = pct;\n    });\n    const totalPct = players.reduce((s, p) => s + (p.finalPercent || 0), 0);\n    players[0].finalPercent += 100 - totalPct;\n    // Clamp final percentages to 3-15\n    players.forEach(p => {\n      p.finalPercent = Math.max(3, Math.min(15, p.finalPercent));\n    });\n    // Normalize to ensure sum is 100\n    const clampedTotal = players.reduce((s, p) => s + (p.finalPercent || 0), 0);\n    const factor = 100 / clampedTotal;\n    players.forEach(p => {\n      p.finalPercent *= factor;\n    });\n    // Final clamp to ensure no percentage exceeds 15%\n    players.forEach(p => {\n      p.finalPercent = Math.max(3, Math.min(15, p.finalPercent));\n    });\n    players.forEach(p => {\n      p.amount = p.finalPercent / 100 * amount;\n    });\n    return players;\n  }\n  reward(p) {\n    let r = 0;\n    if (p.strikeRate > 180) r += 2;else if (p.strikeRate > 150) r += 1;\n    if (p.runs >= 30) r += 1;\n    if (p.economy > 0 && p.economy < 6) r += 1;\n    if (p.wickets >= 2) r += 1;\n    if (p.wickets >= 3) r += 2;\n    return r;\n  }\n}","map":{"version":3,"names":["ContributionCalculatorService","calculate","players","amount","length","sum","reduce","s","p","opportunityScore","forEach","pct","reward","Math","max","min","finalPercent","totalPct","clampedTotal","factor","r","strikeRate","runs","economy","wickets"],"sources":["C:\\Users\\yash3\\Downloads\\cricket-fee-distributor-v2\\src\\app\\services\\contribution-calculator.service.ts"],"sourcesContent":["import { Player } from '../models/player.model';\n\nexport class ContributionCalculatorService {\n  calculate(players: Player[], amount:number):Player[]{\n    if(players.length === 0) return players;\n    const sum = players.reduce((s,p)=>s+(p.opportunityScore||0),0);\n\n    players.forEach(p=>{\n      let pct = ((p.opportunityScore||0)/sum)*100;\n      pct -= this.reward(p);\n      pct = Math.max(3, Math.min(15, pct));\n      p.finalPercent = pct;\n    });\n\n    const totalPct = players.reduce((s,p)=>s+(p.finalPercent||0),0);\n    players[0].finalPercent! += (100-totalPct);\n\n    // Clamp final percentages to 3-15\n    players.forEach(p => {\n      p.finalPercent = Math.max(3, Math.min(15, p.finalPercent!));\n    });\n\n    // Normalize to ensure sum is 100\n    const clampedTotal = players.reduce((s,p)=>s+(p.finalPercent||0),0);\n    const factor = 100 / clampedTotal;\n    players.forEach(p => {\n      p.finalPercent! *= factor;\n    });\n\n    // Final clamp to ensure no percentage exceeds 15%\n    players.forEach(p => {\n      p.finalPercent = Math.max(3, Math.min(15, p.finalPercent!));\n    });\n\n    players.forEach(p=>{\n      p.amount = (p.finalPercent!/100)*amount;\n    });\n    return players;\n  }\n\n  private reward(p:Player):number{\n    let r=0;\n    if(p.strikeRate>180) r+=2;\n    else if(p.strikeRate>150) r+=1;\n    if(p.runs>=30) r+=1;\n    if(p.economy>0 && p.economy<6) r+=1;\n    if(p.wickets>=2) r+=1;\n    if(p.wickets>=3) r+=2;\n    return r;\n  }\n}"],"mappings":"AAEA,OAAM,MAAOA,6BAA6B;EACxCC,SAASA,CAACC,OAAiB,EAAEC,MAAa;IACxC,IAAGD,OAAO,CAACE,MAAM,KAAK,CAAC,EAAE,OAAOF,OAAO;IACvC,MAAMG,GAAG,GAAGH,OAAO,CAACI,MAAM,CAAC,CAACC,CAAC,EAACC,CAAC,KAAGD,CAAC,IAAEC,CAAC,CAACC,gBAAgB,IAAE,CAAC,CAAC,EAAC,CAAC,CAAC;IAE9DP,OAAO,CAACQ,OAAO,CAACF,CAAC,IAAE;MACjB,IAAIG,GAAG,GAAI,CAACH,CAAC,CAACC,gBAAgB,IAAE,CAAC,IAAEJ,GAAG,GAAE,GAAG;MAC3CM,GAAG,IAAI,IAAI,CAACC,MAAM,CAACJ,CAAC,CAAC;MACrBG,GAAG,GAAGE,IAAI,CAACC,GAAG,CAAC,CAAC,EAAED,IAAI,CAACE,GAAG,CAAC,EAAE,EAAEJ,GAAG,CAAC,CAAC;MACpCH,CAAC,CAACQ,YAAY,GAAGL,GAAG;IACtB,CAAC,CAAC;IAEF,MAAMM,QAAQ,GAAGf,OAAO,CAACI,MAAM,CAAC,CAACC,CAAC,EAACC,CAAC,KAAGD,CAAC,IAAEC,CAAC,CAACQ,YAAY,IAAE,CAAC,CAAC,EAAC,CAAC,CAAC;IAC/Dd,OAAO,CAAC,CAAC,CAAC,CAACc,YAAa,IAAK,GAAG,GAACC,QAAS;IAE1C;IACAf,OAAO,CAACQ,OAAO,CAACF,CAAC,IAAG;MAClBA,CAAC,CAACQ,YAAY,GAAGH,IAAI,CAACC,GAAG,CAAC,CAAC,EAAED,IAAI,CAACE,GAAG,CAAC,EAAE,EAAEP,CAAC,CAACQ,YAAa,CAAC,CAAC;IAC7D,CAAC,CAAC;IAEF;IACA,MAAME,YAAY,GAAGhB,OAAO,CAACI,MAAM,CAAC,CAACC,CAAC,EAACC,CAAC,KAAGD,CAAC,IAAEC,CAAC,CAACQ,YAAY,IAAE,CAAC,CAAC,EAAC,CAAC,CAAC;IACnE,MAAMG,MAAM,GAAG,GAAG,GAAGD,YAAY;IACjChB,OAAO,CAACQ,OAAO,CAACF,CAAC,IAAG;MAClBA,CAAC,CAACQ,YAAa,IAAIG,MAAM;IAC3B,CAAC,CAAC;IAEF;IACAjB,OAAO,CAACQ,OAAO,CAACF,CAAC,IAAG;MAClBA,CAAC,CAACQ,YAAY,GAAGH,IAAI,CAACC,GAAG,CAAC,CAAC,EAAED,IAAI,CAACE,GAAG,CAAC,EAAE,EAAEP,CAAC,CAACQ,YAAa,CAAC,CAAC;IAC7D,CAAC,CAAC;IAEFd,OAAO,CAACQ,OAAO,CAACF,CAAC,IAAE;MACjBA,CAAC,CAACL,MAAM,GAAIK,CAAC,CAACQ,YAAa,GAAC,GAAG,GAAEb,MAAM;IACzC,CAAC,CAAC;IACF,OAAOD,OAAO;EAChB;EAEQU,MAAMA,CAACJ,CAAQ;IACrB,IAAIY,CAAC,GAAC,CAAC;IACP,IAAGZ,CAAC,CAACa,UAAU,GAAC,GAAG,EAAED,CAAC,IAAE,CAAC,CAAC,KACrB,IAAGZ,CAAC,CAACa,UAAU,GAAC,GAAG,EAAED,CAAC,IAAE,CAAC;IAC9B,IAAGZ,CAAC,CAACc,IAAI,IAAE,EAAE,EAAEF,CAAC,IAAE,CAAC;IACnB,IAAGZ,CAAC,CAACe,OAAO,GAAC,CAAC,IAAIf,CAAC,CAACe,OAAO,GAAC,CAAC,EAAEH,CAAC,IAAE,CAAC;IACnC,IAAGZ,CAAC,CAACgB,OAAO,IAAE,CAAC,EAAEJ,CAAC,IAAE,CAAC;IACrB,IAAGZ,CAAC,CAACgB,OAAO,IAAE,CAAC,EAAEJ,CAAC,IAAE,CAAC;IACrB,OAAOA,CAAC;EACV","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
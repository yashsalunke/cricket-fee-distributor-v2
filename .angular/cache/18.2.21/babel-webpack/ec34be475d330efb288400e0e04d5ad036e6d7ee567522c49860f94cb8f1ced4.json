{"ast":null,"code":"export class ContributionCalculatorService {\n  calculate(players, amount) {\n    if (players.length === 0) return players;\n    const sum = players.reduce((s, p) => s + (p.opportunityScore || 0), 0);\n    players.forEach(p => {\n      let pct = (p.opportunityScore || 0) / sum * 100;\n      pct += this.reward(p);\n      pct = Math.max(3, Math.min(15, pct));\n      p.finalPercent = pct;\n    });\n    const totalPct = players.reduce((s, p) => s + (p.finalPercent || 0), 0);\n    players[0].finalPercent += 100 - totalPct;\n    // Clamp final percentages to 3-15\n    players.forEach(p => {\n      p.finalPercent = Math.max(3, Math.min(15, p.finalPercent));\n    });\n    // Normalize to ensure sum is 100\n    const clampedTotal = players.reduce((s, p) => s + (p.finalPercent || 0), 0);\n    const factor = 100 / clampedTotal;\n    players.forEach(p => {\n      p.finalPercent *= factor;\n    });\n    // Final clamp to ensure no percentage exceeds 15%\n    players.forEach(p => {\n      p.finalPercent = Math.max(3, Math.min(15, p.finalPercent));\n    });\n    players.forEach(p => {\n      p.amount = p.finalPercent / 100 * amount;\n    });\n    return players;\n  }\n  reward(p) {\n    let r = 0;\n    if (p.strikeRate > 180) r += 2;else if (p.strikeRate > 150) r += 1;\n    if (p.runs >= 30) r += 1;\n    if (p.economy > 0 && p.economy < 6) r += 1;\n    if (p.wickets >= 2) r += 1;\n    if (p.wickets >= 3) r += 2;\n    return r;\n  }\n}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}